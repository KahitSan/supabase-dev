# DigitalOcean Shared CPU: 2GB RAM / 2 CPUs ($18/mo)
# Usage: docker compose -f docker-compose.yml -f docker-compose.do-2gb-2cpu.yml up

services:
  studio:
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 220M

  kong:
    deploy:
      resources:
        limits:
          cpus: '0.20'
          memory: 280M

  auth:
    deploy:
      resources:
        limits:
          cpus: '0.12'
          memory: 60M

  rest:
    deploy:
      resources:
        limits:
          cpus: '0.12'
          memory: 40M

  storage:
    deploy:
      resources:
        limits:
          cpus: '0.20'
          memory: 140M

  imgproxy:
    deploy:
      resources:
        limits:
          cpus: '0.12'
          memory: 60M

  meta:
    deploy:
      resources:
        limits:
          cpus: '0.20'
          memory: 100M

  supavisor:
    deploy:
      resources:
        limits:
          cpus: '0.29'
          memory: 280M

  db:
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 868M
    command:
      [
        "postgres",
        "-c", "config_file=/etc/postgresql/postgresql.conf",
        "-c", "log_min_messages=fatal",
        "-c", "shared_buffers=128MB",
        "-c", "effective_cache_size=256MB",
        "-c", "maintenance_work_mem=32MB",
        "-c", "checkpoint_completion_target=0.9",
        "-c", "wal_buffers=4MB",
        "-c", "default_statistics_target=100",
        "-c", "work_mem=4MB",
        "-c", "max_worker_processes=4",
        "-c", "max_parallel_workers_per_gather=2",
        "-c", "max_parallel_workers=4"
      ]

# Total: 2.0 CPUs, 2048MB RAM

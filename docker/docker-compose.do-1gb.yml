# DigitalOcean Shared CPU: 1GB RAM / 1 CPU
# Total stack limit enforced by do-limits.sh using systemd
# Services share resources dynamically - no per-service limits

services:
  db:
      command:
        [
          "postgres",
          "-c", "config_file=/etc/postgresql/postgresql.conf",
          "-c", "log_min_messages=fatal",
          "-c", "shared_buffers=64MB",
          "-c", "effective_cache_size=128MB",
          "-c", "maintenance_work_mem=16MB",
          "-c", "checkpoint_completion_target=0.9",
          "-c", "wal_buffers=2MB",
          "-c", "default_statistics_target=50",
          "-c", "random_page_cost=1.1",
          "-c", "effective_io_concurrency=200",
          "-c", "work_mem=2MB",
          "-c", "min_wal_size=512MB",
          "-c", "max_wal_size=1GB",
          "-c", "max_worker_processes=2",
          "-c", "max_parallel_workers_per_gather=1",
          "-c", "max_parallel_workers=2"
        ]
  
  # Total allocation: 1.0 CPU, ~1000MB RAM
